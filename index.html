<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Magic Mall Lottie Editor</title>
  <meta name="theme-color" content="#eaf3ff">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.6/lottie.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
  
</head>
<body>
  
  <div id="dropOverlay">
    <i class="ri-drag-drop-line" style="font-size: 64px; margin-bottom: 16px;"></i>
    Drop Lottie File Here
  </div>

  <header>
    <div class="brand">
      <img src="logo.svg" class="app-logo" alt="Logo">
      Magic Mall
      <span>Editor</span>
    </div>
    <div class="actions">
      <label class="btn-label primary">
        <i class="ri-upload-cloud-line"></i> Open
        <input id="fileInput" type="file" accept=".json,.tgs" />
      </label>
      <button id="undoBtn" class="ghost"><i class="ri-arrow-go-back-line"></i></button>
      <button id="redoBtn" class="ghost"><i class="ri-arrow-go-forward-line"></i></button>
      <button id="settingsBtn" class="ghost" title="Animation Settings"><i class="ri-settings-3-line"></i></button>
      <button id="tgsScanBtn" class="ghost" title="Check TGS Compatibility">
        <i class="ri-telegram-line"></i> TGS Scan
      </button>
      <button id="exportMenuBtn"><i class="ri-download-2-line"></i> Save</button>
      <button id="darkToggle"><i class="ri-moon-line"></i></button>
    </div>
  </header>
  
  <div id="browserWarning" style="background-color: #fff3cd; color: #856404; padding: 10px 20px; text-align: center; border-radius: 8px; margin: 0 12px; font-size: 13px; display: none; border: 1px solid #ffeeba;">
      ⚠️ **Warning!** Downloads are **blocked** in this app. Please use the menu (•••) > **Open in Browser** to save your files.
  </div>
  
  <main>
    <section class="card preview-section">
      
      <div id="loadingIndicator" style="position: absolute; inset: 0; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(5px); z-index: 50; display: none; align-items: center; justify-content: center; flex-direction: column;">
          <div id="loaderAnim" style="width: 100px; height: 100px;"></div>
          <p style="color: var(--primary); font-weight: 600; margin-top: 10px;">Loading Animation...</p>
      </div>
      <div class="canvas-container">
        <div id="preview-placeholder" style="color:var(--text-muted);text-align:center; position:absolute;">
          <i class="ri-image-add-line" style="font-size:32px;opacity:0.5"></i><br>Open a JSON/TGS file
        </div>
        <div id="anim"></div>
      </div>

      <div class="controls-bar">
        <div class="timeline">
          <button id="playPauseBtn" class="primary" style="padding:6px 12px"><i class="ri-play-fill"></i></button>
          <input id="frameSlider" type="range" value="0" min="0" max="100" disabled />
          <div class="muted" style="width:70px; text-align:right; font-size:11px"> 
             <span id="frameLabel">0</span> / <span id="totalLabel">0</span> 
          </div>
        </div>
        
        <div class="filters-row">
          <div class="filter-pills">
            <button class="filter-btn active" data-filter="All">All</button>
            <button class="filter-btn" data-filter="Fill">Fill</button>
            <button class="filter-btn" data-filter="Stroke">Stroke</button>
            <button class="filter-btn" data-filter="Gradient Fill">Gradient Fill</button>
            <button class="filter-btn" data-filter="Gradient Stroke">Gradient Stroke</button>
          </div>
          
          <div style="display:flex; align-items:center; gap:6px; margin-left:4px;">
            <input id="groupDuplicates" type="checkbox" style="accent-color:var(--primary)">
            <label for="groupDuplicates" style="font-size:11px; color:var(--text-muted)">Group Colors</label>
          </div>
        </div>
      </div>
    </section>

    <section class="card editor-section">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('colors')">Colors (<span id="colorStats">0</span>)</button>
        <button class="tab-btn" onclick="switchTab('themes')">Themes</button>
        <button class="tab-btn" onclick="switchTab('layers')">Layers</button>
        <button id="resetColorsBtn" class="danger-btn" style="padding:6px 10px; font-size:12px; margin-left:auto" title="Reset Colors">
          <i class="ri-refresh-line"></i> Reset
        </button>
      </div>

      <div id="tab-colors" class="tab-content active">
        <div id="colors"></div>
      </div>
      
      <div id="tab-themes" class="tab-content">
          <button id="saveThemeBtn" class="primary" style="width:100%; margin-bottom:15px;"><i class="ri-save-line"></i> Save Current Colors as Theme</button>
          <div id="themesList">
              <p style="color:var(--text-muted); font-size:13px; text-align:center;">No themes saved yet.</p>
          </div>
      </div>
      
      <div id="tab-layers" class="tab-content">
        <div style="display:flex;justify-content:flex-end;margin-bottom:8px">
           <button id="refreshLayers" style="padding:4px 8px;font-size:11px">Refresh</button>
        </div>
        <div id="layerList"></div>
      </div>
    </section>
  </main>

  <div id="export-modal" class="modal" aria-hidden="true">
    <div class="modalCard"></div>
  </div>
  
  <div id="tgs-scan-modal" class="modal" aria-hidden="true">
    <div class="modalCard">
        <h3 style="margin-top:0"><i class="ri-telegram-line"></i> TGS Compatibility Scan</h3>
        <p class="muted" style="margin-top:-10px; font-size:13px;">Checking against Telegram's technical requirements.</p>
        <div id="tgs-results"></div>
        <p class="muted" style="font-size:11px; margin-top:15px;">**Note:** This tool cannot check the **64 KB file size** limit.</p>
        <div class="modal-btn-row">
            <button class="primary modal-close" style="background:#2AABEE; border:none;">
                Go to Export
            </button>
            <button class="ghost modal-close" style="color:var(--text-muted); border-color:var(--surface-border)">
                Close
            </button>
        </div>
    </div>
  </div>
 
  <div id="settings-modal" class="modal" aria-hidden="true">
    <div class="modalCard">
      <h3 style="margin-top:0">Animation Settings</h3>
      <div class="setting-row">
        <label>Width (px)</label>
        <input type="number" id="set-w" class="setting-input">
      </div>
      <div class="setting-row">
        <label>Height (px)</label>
        <input type="number" id="set-h" class="setting-input">
      </div>
      <div class="setting-row">
        <label>Frame Rate (fps)</label>
        <input type="number" id="set-fr" class="setting-input">
      </div>
      <div class="setting-row">
        <label>Scale (%)</label>
        <input type="number" id="set-scale" class="setting-input" value="100">
      </div>
      <div style="margin-top:20px; display:flex; gap:10px">
        <button id="applySettings" class="primary" style="flex:1">Apply</button>
        <button class="ghost modal-close settings-close" style="flex:1">Cancel</button>
      </div>
    </div>
  </div>

  <div style="text-align:center; font-size:11px; color:var(--text-muted); padding-bottom:12px">
    Created By @Magic_Mall_GameShop © 2025
  </div>

  <script src="script.js"></script>
</body>
</html>
